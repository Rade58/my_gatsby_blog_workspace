# SADA STVARNO DA SE POZABAVIM DEVICONSIMA

***
*** 
IZ POTREBE DA TI DEVELOPMENT BUILD BUDE BRZI, PRIVREMENO PRESTAN IDA KORISTIS CLOUDINARY

VIDIM

**POTREBNO JE SAMO DA COMMENT-UJES OUT CODE VEZAN ZA CLOUDINARY I ENV VARIJABLE, KOJI SE NALAZI U**

`packages/gatsby-theme-raedal/gatsby-config.js`

**ISTO TAKO, PRIVREMENO UKLONI `gatsby-transformer-cloudinary`**

- `yarn workspace gatsby-theme-raedal remove gatsby-transformer-cloudinary`

*COMMENTOVAO SAM OUT SVE IZ KONFIGURACIJE STA SE TICALO CLOUDINARY-JA, A NISAM DEINSTALIRAO TRANSFORMER I ZATO JE JAVLJALO ERROR I FAILED BUILD; **ZATO STO SAMI CLOUDINARY TRANSFORMER USTVARI UBACUJE NESTO U MOJ SCHEMA DEFINITIONS, STO SE ONDA NE MOZE EVALUATE-OVATI JER SAM UKLONIO TRANSFORMERA***

ZATO SAM DAKLE UKLONIO, POMENUTI PAKET

***
***

MORAM SE ODLUCITI DA LI DA SVG STRINGIFY-UJEM PA DA GA UZMEM KROZ STATIC QUERY

MISLIM DA JE TO BOLJE OPCIJA NEGO DA RADIM ONO STA TRENUTNO RADIMA A TO JE LOADING SLIKE U `useEffect-OVOM` CALLBACK-U (TO JE TRENUTNO UPOTREBLJENO U `packages/gatsby-theme-raedal/src/components/group-page-components/heading-major.tsx` FAJLU)

# DAKLE KRECEM OD FOLDERA KOJI IMAM

MENI SE DEVICONS NALAZE U `packages/gatsby-theme-raedal/src/ICONS/devicons-in-use`

# :one: ZATIM CU IZMENITI SCHEMA-U, DODAJUCI JEDAN NOVI FIELD NA `GroupPage` TYPE-U

TAJ FIELD CE SE ODNOSITI NA STRINGIFIED SVG I ZVACE SE

**`icon`**

# :two: ONDA PRILIKOM KREIRANJA GROUP PAGE NODE-A, PROSLEDJUJEM UPRAVO GROUP NAME, ZA TAJ FIELD

TO RADIM DA BIH IMAO STRING KOJIM KREIRAM IME FAJLA, POTREBNO DA SE TAJ IMAGE FILE GET-UJE I PROCITA ASINHRONO

# :three: MORAM DA SE VRATIM U CONFIG FAJL, KAKO BI DEFINISAO KONFIGURACIJU FILESYSTEMA, KOJA TREBA DA LOAD-UJE SVG-JEVE

ALI OPET IMAM PROBLEM, KAKO DA LOAD-UJEM SVG-JEVE FROM THE THEME

MOZDA TO I NE BI TREBAO DA URADIM, ZA THEME

**JER TEMA JE TEMA** 
**NAMENJENA JE DA SE INSTALIRA, A NA NIVOU SITE-A TREBAJU SE PROVIDE-OVATI SVG-JEVI**

PA ZATO I SLUZI GATSBY-JEV GRAPHQL LAYER

*OPET SAM SLUCAJNO OTISAO U KRAJNOST OF REINVENTING THE WHEEL, DOK NISAM SHVATIO, OVO STO SAM MALOCAS SPOMENUO*

***

KADA SI TO URADIO, TREBALO BI DA BUDES U MOGUCNOSTI DA IH QUERY-UJES

PA POKUSAJ, KAKO BI VIDEO STA MOZES DOBITI OD NJIH

***

EVO KAKAV SAM QUERY USPEO DA KREIRAM

```php
query TakeDevicon($relPath: String!){
  allFile(filter: {internal: {mediaType: {eq: "image/svg+xml"}}, relativePath: {eq: $relPath}}) {
  	
  	nodes {
      absolutePath
      relativePath
      
      # OVO SAM SAMO OSTAVIO DA TI KAZEM DA JE MOGUCE QUERY-EOVATI
      # I NA OSNOVU 		ext					(EXTENSIONA, KAO STO JE U MOM SLUCAJU    .svg   )
      # ALI TO NISAM ZNAO PA SAM KORISTIO					mediaType
      ext
      
      
      #  A STO SE TICE RELATIVE PATHA
      # PA TO JE SAMO IME FAJLA, JER SVI TI DA SE IZRAZIM STATIC ASSETS,
      # KOJE LOAD-UJE FILESYSTEM SU 		U TOP LEVELU (NISU U NIKAKVOM FOLDERU
      # BEZ OBZIRA STO SI IM TI NAMENIO FOLDER U SITE FOLDERU PRILIKOM BUILD-A
      
      
    }
  }
}
```

OVO BI BILA QUERY VARIJABLA KOJU BI MOZDA PROSLEDJIVAO DA UZMES NODE

```json
{"relPath": "graphql.svg"}
```

# :three: KREIRACU RESOLVER-A ZA POMENUTI FIELD `icon`, NA `GroupPage` TYPE-U

GDE CU KAO STO SAM REKAO CITATI ASINHRONO SADRZAJ SVG FAJLA

ASINHRONO, JER MI JE CONVINIENT DA KORISTIM async/await SA RESOLVEROM 

TREBACE MI DAKLE

```js
fs.readFile(absolutniPath, 'utf-8', (error, result) =>{})   // USTVARI KORISTICES "base64" UMESTO "utf-8"
```

**OBRATI GORE PAZNJU DA AKO ZELIS DA TI RESULTAT BUDE STRING A NE BUFFER**, DA STAVIS ENCODING **`utf-8`**

**USTVARI IPAK SAM KASNIJE ODLUCIO DA CU KORISTITI `base64`**

- MISLIM DA JE PRVI ARGUMENT, POMENUTE FUNKCIJE PATH DO FAJLA
- DOK JE DRUGI ARGUMENT, CALLBACK SA RESULT-OM ILI ERROR-OM (KORISTICU PROMISE-E NARAVNO)

JA CU USTVARI KORISTITI GORNJI QUERY, ODNOSNO REKREIRACU GA U RESOLVERU, KORISCENJEM **`context.nodeModel.runQuery`** METODE

# :four: JA MOGU KORISTITI `useStaticQuery` ALI MISLIM DA NE MOGU S NJIM DEFINISATI QUERY VARIJABLE; ALI ONO STO MOGU JESTE IZABRATI OD REZULTATA STA MI TREBA I SAMO IZABRATI ONO STA MI TREBA ZA TRENUTNI GROUP

ODNOSNO QUERY-EVACU SA SVE SVG-JEVE U BASE64 FORMATU

ONDA CU IZ RESULT-A PRONACI ONAJ KOJI MI JE KONKRETNO POTREBAN

`MISLIM DA MI TREBA BOLJA STRUKTURA PODATAKA`

`STO NA PRIMER JA NE BIH NAPRAVIO FIELD, KOJEM JE RESULT MAPA`

KAKVA MAPA?

**`KLJUC BI JOJ BIO NAME OF THE GROUP, A VALUE BI BIO BASE64`**

# :five: MEDJUTIM ODLUCIO SAM DA NE KORISTIM POMENUTI `useStaticQuery` IZ RAZLOGA STO BIH MORAU ZA SVAKI PAGE RADITI ISTE OPERACIJE

QUERYEVATI SVE BASE64

PRONACI POTREBNI DA NJEGA UPOTREBIM ZA RELATED PAGE

**I TAKO SVAKI PUT U SLUCAJU SVAKE STRANICE**

`DAKLE IMAO BI SLUCAJ PRI KOJEM SAMO ZA JEDAN PAGE, JA IZNOVA PRA I IZNOVA PRAVIM BASE64 SVIH SVG-JEVA`

# :six: DAKLE POTREBNO JE DA SE QUERY NAPRAVI U SAMOM TEMPLATE-U

- DAKLE SAMO PROSIRUJEM ONAJ QUERY IZ TEMPLATE-A (DA KORISTI I **icon** FIELD)

- PROSIRUJEM TYPESCRIPT DEFFINITIONS, ODNOSNO INCLUDE-UJEM NOVI TYPE

- ODLAZIM U CONTEXT GDE DODAJEM DEFAULT ZA TAJ FIELD

**SVE OSTALO JE VEC SETTED UP**

SAMO JE POTREBNO UPOTREBITI CONTEXT GDE ZELIM

## STO SE TICE GROUP PAGE TEMPLATE-A, MISLIM DA SAM ZABORAVI ODA QUERY-UJEM JOS NEKE FIELD-OVE OD RANIJE A UPOTREBIO SAM IH

***

`packages/gatsby-theme-raedal/src/templates/group-page-template.tsx`

STO ZNACI DA SU SE SERVIRALI DEFAULT-OVI CONTEXTA

OVO NIJE DOBRO, I TREBA TO DA POPRAVIS

(SECAS SE **`lang`** I **`description`** NA GROUP PAGE-U **E PA POTPUNO SI ZABORAVIO DA IH STAVIS U QUERI**)

***

**`POPRAVICU TO`** DODACU I POMENUTE FIELD-OVE U QUERY, KADA BUDEM DODAVAO I `icon` FIELD
